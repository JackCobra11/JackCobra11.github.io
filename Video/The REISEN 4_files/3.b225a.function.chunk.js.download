(window.webpackJsonpwebpackLogReporter=window.webpackJsonpwebpackLogReporter||[]).push([[3],{89:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i=o(t(2)),a=o(t(26));function o(e){return e&&e.__esModule?e:{default:e}}function n(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var s=function(){function e(){!function(e,r){if(!(e instanceof r))try{throw new TypeError("Cannot call a class as a function")}catch(e){}}(this,e),this.browser=i.default.myBrowser(),this.reportUrls=["//api.bilibili.com/x/web-interface/cdn/report?from=report","//i0.hdslb.com/bfs/test/ce1cf20203c303963e78c811b01100667c960bba.png"],this.headers={},this.reqFinished=0,this.collectUrlInfo()}var r,t,o;return r=e,(t=[{key:"getHeader",value:function(e,r){var t=e.getAllResponseHeaders();if(-1<t.indexOf(r.toLowerCase())){var o=new RegExp(r,"i"),n=t.match(o)[0];return e.getResponseHeader(n)}return""}},{key:"collectUrlInfo",value:function(){var n=this;this.reportUrls.forEach(function(e,t){var o=a.default.ajax({url:e,noCredentials:!0,success:function(){var e=n.getHeader(o,"x-cache-webcdn"),r=n.getHeader(o,"x-service-module");n.headers[t]={cdn:e,protocol:r},n.reqFinished++,n.reqFinished===n.reportUrls.length&&n.reportCdn()},fail:function(){n.reqFinished++,n.reqFinished===n.reportUrls.length&&n.reportCdn()}})})}},{key:"getResourceList",value:function(){return window.performance&&"function"==typeof performance.getEntriesByType?performance.getEntriesByType("resource"):[]}},{key:"matchUrl",value:function(e){for(var r=0;r<this.reportUrls.length;r++)if(-1<e.indexOf(this.reportUrls[r]))return r;return-1}},{key:"reportCdn",value:function(){var t=this;this.getResourceList().forEach(function(e){var r=t.matchUrl(e.name);-1<r&&t.todo({cdn_addr:t.headers[r].cdn,protocol:t.headers[r].protocol||e.nextHopProtocol,uri:document.baseURI||window.location.href,request_uri:i.default.splitUrlArgs(e.name).path,referrer:document.referrer||"",dns_time:e.domainLookupEnd-e.domainLookupStart,connect_time:e.connectEnd-e.connectStart,request_time:e.responseStart-e.requestStart,response_time:e.responseEnd-e.responseStart,consumer_time:e.duration,request_args:i.default.splitUrlArgs(e.name).args,initiator_type:e.initiatorType,error:""},!0)})}},{key:"todo",value:function(e,r){var t=0<arguments.length&&void 0!==e?e:{},o=1<arguments.length?r:void 0,n={log_id:200001,browser:this.browser,uri:t.uri,user_agent:navigator.userAgent,mid:Number(i.default.getCookie("DedeUserID")||0),buvid:i.default.getCookie("buvid3")||"",referrer:t.referrer,extended_fields:{cdn_addr:t.cdn_addr,request_uri:t.request_uri||"",start_request_ts:(Math.floor(t.start_request_ts)||Date.parse(new Date)/1e3).toString(),dns_time:(Math.floor(t.dns_time)||"0").toString(),hit_cache:t.hit_cache||"",cdn_hostname:t.cdn_hostname||"",idc:t.idc||"",connect_time:(Math.floor(t.connect_time)||"0").toString(),request_time:("0"|Math.floor(t.request_time)).toString(),response_time:(Math.floor(t.response_time)||"0").toString(),consumer_time:(Math.floor(t.consumer_time)||"0").toString(),request_args:encodeURI(t.request_args||""),initiator_type:String.prototype.toLocaleLowerCase.call(t.initiator_type||""),error:null==t.error?"error":t.error}};o&&(n.extended_fields.protocol=t.protocol),a.default.post("//apm-misaka.biliapi.net/misaka/web/report?cross_domain=true",JSON.stringify(n))}}])&&n(r.prototype,t),o&&n(r,o),e}();r.default=s}}]);